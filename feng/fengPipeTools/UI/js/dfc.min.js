/**
 * -------- dfc.js library ----------
 * -------- depend in JQuery --------
 * -------- author : bc8 ------------
 * -------- updateDate : 2017 -------
 */
Array.prototype.remove = function(val) {
    var index = this.indexOf(val);
    if (index > -1) {
    this.splice(index, 1);
    }
};

var DFC = function(){
    var STATIC_CONTROL_NOTICE_SETTIMEOUT = true;
};

/**
 *  --- 判断是否是数值 ---
 *  @param1 num*: 判断的数值
 *  @param2 boolean 判断是否包含负数，默认为false
 *  @param3 boolean 判断是否是整数，默认为false
 *  @return boolean
 */
DFC.prototype.isNumber = function(num) {
    if (num || num == 0) {
        var rex;
        if (arguments[1] === true) {

            if (arguments[2] === true) rex = /^-?[0-9]*[1-9][0-9]*$/;
            else rex = /^-?[0-9]+([.]{1}[0-9]+){0,1}$/;

            if (rex.test(num)) return true;
        } else {
            
            if (arguments[2] === true) rex = /^[0-9]*[1-9][0-9]*$/;
            else rex = /^[0-9]+([.]{1}[0-9]+){0,1}$/;

            if (rex.test(num)) return true;
        }
    }
    return false;
}

/**
 用户输入数据验证，通过change事件来触发此函数
 *  @param1 target*: 操作的元素对象或者元素ID
 *  @param2 min: 最小值 默认为 1
 *  @param3 max: 最大值默认不做限制
 *  @param4 callback: 进一步自定义处理，参数为当前input的值
 *  @return boolean
 */
DFC.prototype._numberLimit = function(target) {

    if (typeof target == 'undefined') return false;
    var this_val; //input的值
    if (typeof target == 'string') {
        this_val = $('#' + target).val();
    } else if (typeof target == 'object') {
        this_val = $(target).val();
    }
    //判断input的值
    if (this.isNumber(this_val, true) === true) {
        var min = arguments[1] || 1;
        var max = arguments[2] || '';
        var callback = arguments[3];
        if (max) {
            if (this_val > max || this_val < min) {
                this.alert('您好，请输入' + min + '到' + max + '的数字');
            } else {
                if (callback) callback(this_val);
                return true;
            }
        } else {
            if (this_val < min) {
                this.alert('您好，输入数值须比' + min + '大');
            } else {
                if (callback) callback(this_val);
                return true;
            }
        }
    } else {
        this.alert('您好，只能输入数字');
    }
    if (typeof target == 'string') {
        $('#' + target).val('');
    } else if (typeof target == 'object') {
        $(target).val('');
    }
    return false;
}

/**
 *  --- select中自定义转换文本框 ---
 *  @param1 obj*: 操作的 select jQuery元素对象
 */
DFC.prototype.customOption = function(target) {
    var target = $('#'+target);
    //找出末尾的 option
    target.change(function() {
        var end_option = target.children().last();
        if (target.val() == end_option.val()) {
            var text_width = target.width() - 20;
            var text_height = target.height();
            var top = target[0].offsetTop+1;
            var left = target[0].offsetLeft-6;
            var html = '<input id="bc_unqieuasd" style="border: none;height: ' + text_height + 'px;width: ' + text_width + 'px;position: absolute; left: ' + left + 'px; top: ' + top + 'px" type="text" />';
            // text
            $(html).appendTo(target.parent());
            // Add option to select
            $("#bc_unqieuasd").change(function() {
                var val = $(this).val();
                end_option.prev().siblings().removeAttr('selected');
                var sel = end_option.before('<option selected="selected" value="' + val + '">' + val + '</option>');
                //hide
                $(this).remove();
                return true;
            });
        }
    });
    return false;
}
/**
 *  --- 自定义 alert 消息窗体 ---
 *  param1 msg 提示消息
 */
 DFC.prototype.alert = function(msg){
 	var html = '<div class="DHALKJSDHLAKSHD" style="width: 200px; height: 100px; background: #111;border-radius: 10px;opacity: 0.8;position: absolute;left: 50%; top: 50%;margin-left: -100px; margin-top: -50px;"><p style="font-size: 14px;text-align: center; line-height: 100px; color: #ddd">'+msg+'</p></div>';
 	$(html).appendTo($('body'));
    // if(this.STATIC_CONTROL_NOTICE_SETTIMEOUT === true){
        setTimeout(function(){
            $('.DHALKJSDHLAKSHD').stop(false, true).fadeOut('', function(){
                $('.DHALKJSDHLAKSHD').remove();
            });
        }, 1000);        
    // }
 	return msg;
 }
/**
 *  --- 格式化表单数据 ---
 *  param1 form 表单对象
 *  param2 json json
 */
 DFC.prototype.serialize = function(form, json, callback){
 	var arr = $('#'+form).serializeArray();
 	var res = {};
    var res2 = {};
    var res3 = {};
    var tmp_arr = [];
 	//处理array
 	$.each(arr, function(k, v){
 		res[v.name] = v.value;
 	});
    $.each(res, function(k, v){
        res2[k] = v;
    });
    $.each(res2, function(k, v){
        var path = k.split('-');
        var k2 = path.pop();
        var next_node = res2;
        $.each(path, function(k2, node){
            if(!next_node[node]){
                next_node[node] = {};
            }
            next_node = next_node[node];
        });
        next_node[k2]= v;
    });  
    if(arguments[1] && arguments[1] == true){
        var json = JSON.stringify(res2);
        if(callback){
            callback(json);    
        }
        return json;
    }else{
        if(callback){
            callback(res2);    
        }
        return res2;
    }
 }
 /**
 *  --- 输入提示框 ---
 *  param1 _this 操作对象
 *  param2 notice 提示内容
 */
 DFC.prototype._inputNotice = function(_this, notice){
	var html = '<div class="ASDASFASWQQ" style="position:absolute; display: inline-block; min-width: 160px;z-index:190; background: #f9f8dd; padding: 4px 8px;border-radius: 12px;">'+notice+'</div>';
    if($(_this).val()==''){
        $(html).appendTo($(_this).parent());
            //auto remove
        $(_this).blur(function(){
            $('.ASDASFASWQQ').remove();
        });
    }
 }

 /**
 *  --- 输入框 ---
 *  param1 _this 操作对象
 *  param2 notice 提示内容
 */
 DFC.prototype.confirm = function(msg, callback){
    var html = '<div id="BCALASDOJJKLJK" style="background: #eee;z-index: 99999;position: absolute;left: 50%;top: 50%;margin-top: -50px;margin-left: -100px;padding: 10px;padding-top: 22px;width: 200px; height: 94px;border: 1px solid #aaa; box-shadow: 1px 1px 12px 2px #aaa"><p>'+msg+'</p><input id="GETINUTSADAKJH" style="padding: 2px; height: 22px; width: 177px;" type="text"><div style="padding: 12px;margin-left: 24px"><button style="padding: 3px 14px;" type="button" id="BCQUEDINGASDWQ" value="">确定</button><button id="BCQUXIAOADASDF" style="padding: 3px 14px;" type="button" value="">取消</button></div></div>'
    $(html).appendTo($('body'));
    // ok
    $('#BCQUEDINGASDWQ').bind('click', function(){
        var val = $('#GETINUTSADAKJH').val();
        if(val){
            callback($('#GETINUTSADAKJH').val());
            $('#BCALASDOJJKLJK').remove();            
        }else{
            callback(false);
            $('#BCALASDOJJKLJK').remove();
        }
    });
    //cencel
    $('#BCQUXIAOADASDF').bind('click', function(){
        callback(false);
        $('#BCALASDOJJKLJK').remove();
    });
 }
 /**
 *  --- 设置基点弹出框 ---
 */
 DFC.prototype.setBasePoint = function(){
    var callback = arguments[0] || function(){};
    var html = '<div id="ASDASDAF15245SD" style="box-shadow: 1px 1px 12px 2px #aaa;width: 200px;height: 140px;background: #eee;position: absolute;margin-left: -100px;margin-top: -70px;left: 50%;top: 50%;padding: 10px;"><div style=" position: absolute;left: 25px; top: 20px"><input style="cursor: pointer;" name="base_point" value="1" type="radio"></div><div style=" position: absolute;left: 104px;top: 20px"><input style="cursor: pointer;" name="base_point" value="2" type="radio"></div><div style=" position: absolute;left: 180px;top: 20px"><input style="cursor: pointer;" name="base_point" value="3" type="radio"></div><div style=" position: absolute;left: 25px;top: 80px"><input style="cursor: pointer;" name="base_point" value="4" type="radio"></div><div style=" position: absolute;left: 102px;top: 80px"><input style="cursor: pointer;" name="base_point" checked="checked" value="5" type="radio"></div><div style=" position: absolute;left: 180px;top: 80px"><input style="cursor: pointer;" name="base_point" value="6" type="radio"></div><div style="position: absolute;bottom: 12px;width: 100%; left: 51px;"><button style="padding: 4px 14px;" type="button" id="QUDNKLNKLAN5" value="">确定</button><button style="padding: 4px 14px;" id="QUXIAODASJKL2JAD" type="button" value="">取消</button></div></div>';
    $(html).appendTo($('body'));
    //ok
    $("#QUDNKLNKLAN5").bind('click', function(){
        var val = $('input[name="base_point"]:checked').val();
        if(val){
            callback(val); 
        }else{
            callback(false)
        }
        $("#ASDASDAF15245SD").remove();
    });
    $("#QUXIAODASJKL2JAD").bind('click', function(){
        callback(false);
        $("#ASDASDAF15245SD").remove();
    });
 }

 DFC.prototype._linkage = function(wait_sel, two){
    if(two){
        $('#'+wait_sel).show();
        var wait_sel = $('#'+wait_sel)[0];
        wait_sel.options.length = 0;
        $.each(two, function(k ,v){
            wait_sel.options[k] = new Option(v, v);
        });        
    }

 }

DFC.prototype.copyright = function(){
    var html = '<div style="width: 100%;padding: 10px 0; overflow: hidden; line-height:20px;text-align:center;background: #ddd;position: absolute;bottom: 0;"><p>Copyright &copy;2016 <strong>DFC</strong> 版权所有</p></div>';
    $('body').append(html);
}

 DFC.prototype.loadImage = function(_this, uri){
 	var val = $(_this).val();
 }

 var DFC = new DFC;